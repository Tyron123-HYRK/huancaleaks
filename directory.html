<!DOCTYPE html>
<html lang="es">
<head>
    <!-- Version: 2.1.0 - Directory Edition -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HuancaLeaks - Directorio de Quemados</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel para JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;800&display=swap" rel="stylesheet">
    
    <!-- Iconos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'brand-orange': '#ff7b00',
                        'brand-dark': '#0f0f0f',
                        'brand-gray': '#1a1a1a',
                        'brand-light': '#e5e5e5',
                    },
                    fontFamily: {
                        sans: ['Montserrat', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #0f0f0f;
            color: #e5e5e5;
            background-image: radial-gradient(#ff7b0015 1px, transparent 1px);
            background-size: 30px 30px;
        }
        .glass-panel {
            background: rgba(26, 26, 26, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 123, 0, 0.1);
        }
        .scroll-hide::-webkit-scrollbar {
            display: none;
        }
        /* Table styles */
        .custom-table tbody tr:hover {
            background-color: rgba(255, 123, 0, 0.05);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        const API_URL = '/api';

        const Header = () => (
            <header className="sticky top-0 z-50 glass-panel border-b border-gray-800 shadow-lg shadow-orange-500/10">
                <div className="container mx-auto px-4 py-3 flex justify-between items-center">
                    <div className="flex items-center gap-2 cursor-pointer" onClick={() => window.location.href = '/'}>
                        <i className="fas fa-fire text-brand-orange text-2xl"></i>
                        <h1 className="text-2xl font-extrabold tracking-tighter">
                            HUANCA<span className="text-brand-orange">LEAKS</span>
                        </h1>
                    </div>
                    <div className="flex gap-4">
                        <a href="/huancaleaks.html" className="text-sm font-bold text-gray-400 hover:text-white transition-colors flex items-center gap-2">
                            <i className="fas fa-stream"></i> Feed
                        </a>
                        <a href="/directory.html" className="text-sm font-bold text-brand-orange flex items-center gap-2">
                            <i className="fas fa-list"></i> Directorio
                        </a>
                    </div>
                </div>
            </header>
        );

        const TableRow = ({ post }) => {
            // Attempt to split profession into Career and University if mostly consistent format "Career - University"
            let career = post.profession;
            let uni = "";
            
            if (post.profession && post.profession.includes(" - ")) {
                const parts = post.profession.split(" - ");
                career = parts[0];
                uni = parts[1];
            }

            return (
                <tr className="border-b border-gray-800 transition-colors text-sm">
                    <td className="p-4">
                        <div className="w-12 h-12 rounded-full overflow-hidden border border-gray-700 bg-gray-800">
                            {post.image ? (
                                <img src={post.image} alt="Avatar" className="w-full h-full object-cover" />
                            ) : (
                                <div className="w-full h-full flex items-center justify-center text-gray-500">
                                    <i className="fas fa-user"></i>
                                </div>
                            )}
                        </div>
                    </td>
                    <td className="p-4 font-bold text-white">{post.targetName}</td>
                    <td className="p-4 text-gray-300">{career}</td>
                    <td className="p-4 text-brand-orange font-medium">{uni || <span className="text-gray-600 text-xs italic">No especificado</span>}</td>
                    <td className="p-4 text-gray-400 text-xs hidden md:table-cell">{post.date}</td>
                </tr>
            );
        };

        const App = () => {
            const [posts, setPosts] = useState([]);
            const [loading, setLoading] = useState(true);
            const [searchTerm, setSearchTerm] = useState("");

            useEffect(() => {
                fetchPosts();
            }, []);

            const fetchPosts = async () => {
                try {
                    const response = await fetch(`${API_URL}/posts`);
                    const data = await response.json();
                    
                    const mappedPosts = data.map(p => ({
                        id: p.id,
                        targetName: p.target_name,
                        profession: p.profession,
                        date: new Date(p.date).toLocaleDateString(),
                        image: p.image_url ? (p.image_url.startsWith('http') ? p.image_url : p.image_url) : null
                    }));
                    setPosts(mappedPosts);
                    setLoading(false);
                } catch (error) {
                    console.error("Error fetching posts:", error);
                    setLoading(false);
                }
            };

            const filteredPosts = useMemo(() => {
                return posts.filter(post => {
                    const search = searchTerm.toLowerCase();
                    return (post.targetName || "").toLowerCase().includes(search) ||
                           (post.profession || "").toLowerCase().includes(search);
                });
            }, [posts, searchTerm]);

            return (
                <div className="min-h-screen pb-10 font-sans">
                    <Header />

                    <main className="container mx-auto px-4 py-8">
                        <div className="glass-panel rounded-xl overflow-hidden shadow-2xl">
                            <div className="p-6 border-b border-gray-800 flex flex-col md:flex-row justify-between items-center gap-4">
                                <div>
                                    <h2 className="text-2xl font-bold text-white mb-1">Directorio Público</h2>
                                    <p className="text-gray-400 text-sm">Base de datos completa de reportes</p>
                                </div>
                                <div className="relative w-full md:w-96">
                                    <i className="fas fa-search absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-500"></i>
                                    <input 
                                        type="text" 
                                        placeholder="Buscar por nombre, carrera..." 
                                        className="w-full bg-black/50 border border-gray-700 rounded-full py-2 pl-10 pr-4 text-sm text-white focus:border-brand-orange outline-none transition-all"
                                        value={searchTerm}
                                        onChange={(e) => setSearchTerm(e.target.value)}
                                    />
                                </div>
                            </div>

                            <div className="overflow-x-auto">
                                <table className="w-full text-left border-collapse custom-table">
                                    <thead>
                                        <tr className="bg-black/40 text-xs uppercase tracking-wider text-gray-500 font-bold border-b border-gray-800">
                                            <th className="p-4">Evidencia</th>
                                            <th className="p-4">Nombre / Apodo</th>
                                            <th className="p-4">Carrera / Detalle</th>
                                            <th className="p-4">Institución</th>
                                            <th className="p-4 hidden md:table-cell">Fecha</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {loading ? (
                                            <tr>
                                                <td colSpan="5" className="p-8 text-center text-gray-500 animate-pulse">
                                                    Cargando directorio...
                                                </td>
                                            </tr>
                                        ) : filteredPosts.length > 0 ? (
                                            filteredPosts.map(post => (
                                                <TableRow key={post.id} post={post} />
                                            ))
                                        ) : (
                                            <tr>
                                                <td colSpan="5" className="p-8 text-center text-gray-500">
                                                    No se encontraron resultados.
                                                </td>
                                            </tr>
                                        )}
                                    </tbody>
                                </table>
                            </div>
                            
                            <div className="p-4 border-t border-gray-800 bg-black/20 text-center">
                                <p className="text-xs text-gray-600">Mostrando {filteredPosts.length} registros</p>
                            </div>
                        </div>
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>